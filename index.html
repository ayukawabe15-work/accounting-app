<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>会計アプリ</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="topbar">
    <div class="left"><h1>会計アプリ</h1></div>
    <div class="right">
      <button id="loginButton" class="btn">Googleにログイン</button>
      <span id="loginStatus">未ログイン</span>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-target="tab-input">入力</button>
    <button class="tab" data-target="tab-list">一覧</button>
    <button class="tab" data-target="tab-agg">集計</button>
  </nav>

  <!-- 入力（2～3行に収まるコンパクト版） -->
  <section id="tab-input" class="tab-panel active">
    <form id="entryForm" class="grid-form">
  <!-- 1行目 -->
  <div>
    <label>日付
      <input type="date" id="date" required>
    </label>
  </div>
  <div>
  <label>使い道
    <select id="category">
      <option value="サーバー代">サーバー代</option>
      <option value="スクリプト購入">スクリプト購入</option>
      <option value="機材購入">機材購入</option>
      <option value="雑費">雑費</option>
      <option value="人件費">人件費</option>
      <option value="会食費">会食費</option>
      <option value="その他">その他</option>
    </select>
    <input type="text" id="categoryFree" class="hidden" placeholder="自由入力（任意）">
  </label>
</div>
  <div>
    <label>取引先
      <select id="otherPreset">
        <option value="">(選択しない)</option>
        <option value="Tebex">Tebex</option>
        <option value="VibeGAMES">VibeGAMES</option>
        <option value="Ko-fi">Ko-fi</option>
        <option value="Killstore">Killstore</option>
        <option value="Etsy">Etsy</option>
        <option value="FANBOX">FANBOX</option>
        <option value="ZAP HOSTING">ZAP HOSTING</option>
      </select>
      <input type="text" id="otherFree" placeholder="自由入力（任意）">
    </label>
  </div>
  <div>
    <label>支払方法
      <select id="payment">
        <option value="未選択">未選択</option>
        <option value="銀行振込">銀行振込</option>
        <option value="クレジットカード">クレジットカード</option>
        <option value="PayPal">PayPal</option>
      </select>
    </label>
  </div>

  <!-- 2行目 -->
  <div>
    <label>通貨
      <select id="currency">
        <option value="JPY">JPY（日本円）</option>
        <option value="USD">USD（米ドル）</option>
        <option value="EUR">EUR（ユーロ）</option>
      </select>
    </label>
  </div>
  <div>
    <label>外貨金額
      <input type="number" step="0.01" id="foreignAmount" placeholder="例: 12.34">
    </label>
  </div>
  <div>
    <label>為替レート
      <input type="number" step="0.0001" id="rate" placeholder="1USD=???JPY">
    </label>
    <button type="button" id="autoRateBtn">自動取得</button>
  </div>
  <div>
    <label>金額（円）
      <input type="number" step="1" id="amount" placeholder="自動換算または直接入力">
    </label>
  </div>

  <!-- 3行目 -->
  <div class="wide">
    <label>メモ
      <input type="text" id="memo" placeholder="例：MLO/車MOD/サーバー更新など">
    </label>
  </div>
  <div class="wide">
    <label>ファイル添付（画像/PDF）
      <input type="file" id="fileInput" accept="image/*,.pdf">
    </label>
  </div>

  <!-- 保存ボタン -->
  <div class="wide">
    <button type="submit" class="btn-save">保存（Driveへ自動アップロード）</button>
  </div>
</form>

  <!-- 一覧 -->
  <section id="tab-list" class="tab-panel">
    <div class="card filters">
      <label>年月<input type="month" id="filterMonth" /></label>
      <label>使い道<input type="text" id="filterCategory" placeholder="完全一致で絞り込み" /></label>
      <label>支払方法<input type="text" id="filterMethod" placeholder="完全一致で絞り込み" /></label>
      <label>キーワード
        <input type="text" id="filterText" placeholder="使い道/その他の内容/メモを検索" />
      </label>
      <button id="clearFilters" class="btn">クリア</button>
      <button id="exportCSV" class="btn">CSV出力</button>
    </div>

    <div class="card">
      <table id="recordsTable" class="table compact-table">
        <thead>
          <tr>
            <th>日付</th>
            <th>使い道</th>
            <th>区分</th>
            <th>金額(JPY)</th>
            <th>外貨</th>
            <th>その他の内容</th>
            <th>支払方法</th>
            <th>メモ</th>
            <th>添付</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- 集計 -->
  <section id="tab-agg" class="tab-panel">
    <div class="card">
      <div class="row gap-sm">
        <label>月次<input type="month" id="aggMonth" /></label>
        <label>年次<input type="number" id="aggYear" min="2000" max="2100" /></label>
        <button id="recalc" class="btn">再計算</button>
      </div>

      <div class="grid grid-3 compact">
        <div class="summary-box"><div class="label">月次 収入</div><div id="mIncome" class="val">-</div></div>
        <div class="summary-box"><div class="label">月次 経費</div><div id="mExpense" class="val">-</div></div>
        <div class="summary-box"><div class="label">月次 収支</div><div id="mNet" class="val">-</div></div>
        <div class="summary-box"><div class="label">年次 収入</div><div id="yIncome" class="val">-</div></div>
        <div class="summary-box"><div class="label">年次 経費</div><div id="yExpense" class="val">-</div></div>
        <div class="summary-box"><div class="label">年次 収支</div><div id="yNet" class="val">-</div></div>
      </div>

      <h3>月別内訳</h3>
      <table id="monthlySummary" class="table compact-table">
        <thead><tr><th>月</th><th>収入</th><th>経費</th><th>収支</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- プレビュー -->
  <dialog id="previewModal" class="modal">
    <div class="modal-head">
      <strong>プレビュー</strong>
      <button id="closePreview" class="btn">閉じる</button>
    </div>
    <div id="previewContainer" class="preview"></div>
  </dialog>

  <!-- Google API -->
  <script async defer src="https://apis.google.com/js/api.js"></script>
  <script async defer src="https://accounts.google.com/gsi/client"></script>

  <script src="script.js"></script>
</body>
</html>



