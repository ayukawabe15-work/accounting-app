<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>シンプル会計（保存前確認＋編集対応）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="./style.css" rel="stylesheet" />
</head>
<body>
  <header class="app-header">
    <h1>シンプル会計</h1>
    <div class="auth">
      <button id="gLogin" class="btn">Googleにログイン</button>
      <button id="gLogout" class="btn btn-subtle">ログアウト</button>
      <span id="authState" class="muted">未ログイン</span>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>取引入力</h2>
      <form id="entryForm" autocomplete="off">
        <div class="grid">
          <label class="field">
            <span>日付 <b class="req">*</b></span>
            <input type="date" id="date" required />
          </label>

          <label class="field">
            <span>区分 <b class="req">*</b></span>
            <select id="type" required>
              <option value="支出">支出</option>
              <option value="収入">収入</option>
            </select>
          </label>

          <label class="field">
            <span>勘定科目 <b class="req">*</b></span>
            <input id="category" list="categoryList" placeholder="例: 旅費交通費 / 広告宣伝費 / 売上高 など" required />
            <datalist id="categoryList">
              <option value="売上高"></option>
              <option value="雑収入"></option>
              <option value="旅費交通費"></option>
              <option value="通信費"></option>
              <option value="消耗品費"></option>
              <option value="外注費"></option>
              <option value="サーバー代"></option>
              <option value="スクリプト購入"></option>
            </datalist>
          </label>

          <label class="field">
            <span>取引先（選択）</span>
            <select id="partnerSelect">
              <option value="">— 選択しない —</option>
              <option value="Tebex">Tebex</option>
              <option value="VibeGAMES">VibeGAMES</option>
              <option value="Ko-fi">Ko-fi</option>
              <option value="Killstore">Killstore</option>
              <option value="Etsy">Etsy</option>
              <option value="FANBOX">FANBOX</option>
              <option value="ZAP HOSTING">ZAP HOSTING</option>
            </select>
          </label>

          <label class="field">
            <span>取引先（自由入力）</span>
            <input id="partnerCustom" placeholder="選択にない場合はこちらへ記入" />
          </label>

          <label class="field">
            <span>通貨 <b class="req">*</b></span>
            <select id="currency">
              <option value="JPY">JPY</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="LBP">LB（レバノン・ポンド想定）</option>
            </select>
          </label>

          <label class="field">
            <span>金額（円・JPYの場合はこちら）</span>
            <input id="amount" type="number" min="0" step="1" inputmode="numeric" placeholder="例: 1200" />
          </label>

          <label class="field">
            <span>外貨金額</span>
            <input id="amountFx" type="number" min="0" step="0.01" inputmode="decimal" placeholder="例: 10.00" />
          </label>

          <label class="field">
            <span>為替レート</span>
            <input id="fxRate" type="number" min="0" step="0.0001" inputmode="decimal" placeholder="例: 156.2345" />
          </label>

          <label class="field">
            <span>支払方法</span>
            <input id="method" list="methodList" placeholder="例: PayPal / PayPay / 銀行振込 / 現金" />
            <datalist id="methodList">
              <option value="PayPal"></option>
              <option value="PayPay"></option>
              <option value="銀行振込"></option>
              <option value="クレジットカード"></option>
              <option value="現金"></option>
            </datalist>
          </label>

          <label class="field span2">
            <span>メモ</span>
            <input id="memo" placeholder="任意のメモ" />
          </label>

          <label class="field span2">
            <span>添付（領収書・画面キャプチャ等）</span>
            <input id="fileInput" type="file" />
            <small class="muted">ログイン済みなら Drive に自動アップロード／未ログインでも保存可（添付は後で編集で追加できます）</small>
          </label>
        </div>

        <div class="actions">
          <input type="hidden" id="editingId" />
          <button type="submit" id="saveBtn" class="btn btn-primary">保存（Driveへ自動アップロード）</button>
          <button type="button" id="cancelEdit" class="btn btn-subtle" style="display:none;">編集をキャンセル</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>一覧</h2>
      <div class="table-wrap">
        <table id="recordsTable">
          <thead>
            <tr>
              <th>日付</th>
              <th>勘定科目</th>
              <th>区分</th>
              <th>取引先</th>
              <th>金額(JPY)</th>
              <th>外貨</th>
              <th>支払方法</th>
              <th>メモ</th>
              <th>添付</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="recordsTbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="footer">
    <small class="muted">© Turtle City / Simple Ledger</small>
  </footer>

  <!-- Google API（必要な方のみ）: 有効でなくてもアプリは動作します -->
  <script src="https://apis.google.com/js/api.js?onload=gapiLoaded" async defer onload></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script src="./script.js"></script>
</body>
</html>

